<html>
  <head>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />

    <title>FastDash</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style>
      /* Responsive sidebar: hidden off-canvas on small screens, visible on md+ */
      .sidebar { transition: transform .25s ease-in-out; }
      @media (max-width: 768px) {
        .sidebar { transform: translateX(-100%); position: fixed; left: 0; top: 0; height: 100vh; z-index: 50; width: 18rem; }
        .sidebar.open { transform: translateX(0); }
      }
      @media (min-width: 769px) {
        .sidebar { transform: none; position: static; height: auto; }
      }
      /* small UI polish */
      .hoverable { transition: background-color .12s ease, transform .08s ease; }
      .hoverable:hover { background-color: var(--bg-hover); transform: translateY(-1px); border-radius: 9999px; }
      .rounded-full-important { border-radius: 9999px !important; }
      /* make buttons and module buttons fully round */
      #mainContent button, #sidebar button, #sidebarContent button, .sidebar-item { border-radius: 9999px; }
      #mainContent button:hover, #sidebar button:hover { background-color: var(--bg-hover); transform: translateY(-1px); border-radius: 9999px; }
      /* integrated search bar */
      .search-wrapper { border-radius: 9999px; background: var(--bg-secondary); display: flex; align-items: center; }
      .search-wrapper:focus-within { background: var(--bg-hover); }
      .search-wrapper input { background: transparent !important; }
      .search-wrapper .search-icon { background: transparent !important; }
      
      /* theme support */
      :root {
        --bg-primary: #111118;
        --bg-secondary: #292938;
        --bg-hover: #2f2f3a;
        --text-primary: #ffffff;
        --text-secondary: #9d9db8;
        --accent: #4b7cff;
      }
      
      .theme-light {
        --bg-primary: #ffffff;
        --bg-secondary: #f5f5f5;
        --bg-hover: #e5e5e5;
        --text-primary: #000000;
        --text-secondary: #666666;
        --accent: #4b7cff;
      }
      
      .theme-custom {
        --bg-primary: var(--custom-bg-primary);
        --bg-secondary: var(--custom-bg-secondary);
        --bg-hover: var(--custom-bg-hover);
        --text-primary: var(--custom-text-primary);
        --text-secondary: var(--custom-text-secondary);
        --accent: var(--custom-accent);
      }
      
      /* radio button styling */
      .theme-radio {
        accent-color: var(--accent);
      }
      
      /* course elements styling */
      .course-title {
        color: var(--text-primary);
      }
      
      .course-description {
        color: var(--text-secondary);
      }
      
      .module-button {
        background-color: var(--bg-secondary);
        color: var(--text-primary);
      }
      
      .module-button:hover {
        background-color: var(--bg-hover);
      }
      
      /* Class management styles */
      .edit-icon {
        position: absolute;
        top: 8px;
        right: 8px;
        background: var(--bg-secondary);
        color: var(--text-primary);
        border: 1px solid var(--bg-hover);
        border-radius: 6px;
        padding: 6px;
        cursor: pointer;
        opacity: 0;
        transition: all 0.2s ease;
        z-index: 10;
      }
      
      .course-card:hover .edit-icon {
        opacity: 1;
      }
      
      .edit-icon:hover {
        background: var(--accent);
        color: white;
        border-color: var(--accent);
      }
      
      .course-card {
        position: relative;
      }
      
      .color-tint {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border-radius: 8px;
        pointer-events: none;
      }
      
      .add-class-btn {
        background: var(--bg-secondary);
        color: var(--text-primary);
        border: 2px dashed var(--bg-hover);
        border-radius: 12px;
        padding: 24px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s ease;
        margin: 16px;
      }
      
      .add-class-btn:hover {
        background: var(--bg-hover);
        border-color: var(--accent);
        color: var(--accent);
      }
      
      .help-icon {
        display: inline-block;
        width: 16px;
        height: 16px;
        background: var(--text-secondary);
        color: var(--bg-primary);
        border-radius: 50%;
        text-align: center;
        line-height: 16px;
        font-size: 12px;
        font-weight: bold;
        margin-left: 8px;
        cursor: help;
      }
      
    </style>
  </head>
  <body>
    <div class="relative flex h-auto min-h-screen w-full flex-col dark group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif; background-color: var(--bg-primary);'>
      <div class="layout-container flex h-full grow flex-col">
        <!-- navbar removed -->
        <button id="sidebarToggle" class="md:hidden fixed top-4 left-4 z-60 p-2 rounded-md" style="background-color: var(--bg-secondary); color: var(--text-primary);" aria-label="Open sidebar">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <div id="sidebarOverlay" class="hidden md:hidden fixed inset-0 bg-black bg-opacity-40 z-40"></div>
  <div class="gap-1 px-6 flex flex-1 justify-start items-start py-5">
          <div id="sidebar" class="layout-content-container flex flex-col w-80 sidebar">
            <div class="flex h-full min-h-[700px] flex-col justify-between p-4" style="background-color: var(--bg-primary);">
              <div class="flex flex-col gap-4">
                <div class="flex gap-3">
                  <div id="userIconContainer" class="size-10 rounded-full flex items-center justify-center">
                    <svg id="userIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z" fill="currentColor"/>
                    </svg>
                  </div>
                  <div>
                  <h1 class="text-base font-medium leading-normal" style="color: var(--text-primary);">User</h1>
                  <p class="text-base leading-normal" style="color: var(--text-secondary); font-size: 13px;">User</p>
                  </div>
                </div>
                <div class="flex flex-col gap-2">
                    <div id="sidebarContent">
                    <div class="flex items-center gap-3 px-3 py-2 rounded-full hoverable cursor-pointer" data-action="dashboard" style="background-color: var(--bg-secondary);">
                      <div style="color: var(--text-primary);" data-icon="House" data-size="24px" data-weight="fill">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                        <path
                          d="M224,115.55V208a16,16,0,0,1-16,16H168a16,16,0,0,1-16-16V168a8,8,0,0,0-8-8H112a8,8,0,0,0-8,8v40a16,16,0,0,1-16,16H48a16,16,0,0,1-16-16V115.55a16,16,0,0,1,5.17-11.78l80-75.48.11-.11a16,16,0,0,1,21.53,0,1.14,1.14,0,0,0,.11.11l80,75.48A16,16,0,0,1,224,115.55Z"
                        ></path>
                      </svg>
                    </div>
                    <p class="text-sm font-medium leading-normal" style="color: var(--text-primary);">Dashboard</p>
                  </div>
                  <div class="flex items-center gap-3 px-3 py-2 hoverable cursor-pointer" data-action="courses">
                    <div style="color: var(--text-primary);" data-icon="BookOpen" data-size="24px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                        <path
                          d="M224,48H160a40,40,0,0,0-32,16A40,40,0,0,0,96,48H32A16,16,0,0,0,16,64V192a16,16,0,0,0,16,16H96a24,24,0,0,1,24,24,8,8,0,0,0,16,0,24,24,0,0,1,24-24h64a16,16,0,0,0,16-16V64A16,16,0,0,0,224,48ZM96,192H32V64H96a24,24,0,0,1,24,24V200A39.81,39.81,0,0,0,96,192Zm128,0H160a39.81,39.81,0,0,0-24,8V88a24,24,0,0,1,24-24h64Z"
                        ></path>
                      </svg>
                    </div>
                    <p class="text-sm font-medium leading-normal" style="color: var(--text-primary);">Courses</p>
                  </div>
                  <div class="flex items-center gap-3 px-3 py-2 hoverable cursor-pointer" data-action="history">
                    <div style="color: var(--text-primary);" data-icon="Users" data-size="24px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                        <path
                          d="M117.25,157.92a60,60,0,1,0-66.5,0A95.83,95.83,0,0,0,3.53,195.63a8,8,0,1,0,13.4,8.74,80,80,0,0,1,134.14,0,8,8,0,0,0,13.4-8.74A95.83,95.83,0,0,0,117.25,157.92ZM40,108a44,44,0,1,1,44,44A44.05,44.05,0,0,1,40,108Zm210.14,98.7a8,8,0,0,1-11.07-2.33A79.83,79.83,0,0,0,172,168a8,8,0,0,1,0-16,44,44,0,1,0-16.34-84.87,8,8,0,1,1-5.94-14.85,60,60,0,0,1,55.53,105.64,95.83,95.83,0,0,1,47.22,37.71A8,8,0,0,1,250.14,206.7Z"
                        ></path>
                      </svg>
                    </div>
                    <p class="text-sm font-medium leading-normal" style="color: var(--text-primary);">History</p>
                  </div>
                  <a class="flex items-center gap-3 px-3 py-2 hoverable" href="https://lhps.instructure.com/calendar#view_name=month&view_start=2025-10-27" target="_blank" rel="noopener">
                    <div style="color: var(--text-primary);" data-icon="Calendar" data-size="24px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                        <path
                          d="M208,32H184V24a8,8,0,0,0-16,0v8H88V24a8,8,0,0,0-16,0v8H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM72,48v8a8,8,0,0,0,16,0V48h80v8a8,8,0,0,0,16,0V48h24V80H48V48ZM208,208H48V96H208V208Zm-96-88v64a8,8,0,0,1-16,0V132.94l-4.42,2.22a8,8,0,0,1-7.16-14.32l16-8A8,8,0,0,1,112,120Zm59.16,30.45L152,176h16a8,8,0,0,1,0,16H136a8,8,0,0,1-6.4-12.8l28.78-38.37A8,8,0,1,0,145.07,132a8,8,0,1,1-13.85-8A24,24,0,0,1,176,136,23.76,23.76,0,0,1,171.16,150.45Z"
                        ></path>
                      </svg>
                    </div>
                    <p class="text-sm font-medium leading-normal" style="color: var(--text-primary);">Calendar</p>
                  </a>
                  <a class="flex items-center gap-3 px-3 py-2 hoverable" href="https://lhps.instructure.com/conversations#filter=type=inbox" target="_blank" rel="noopener">
                    <div style="color: var(--text-primary);" data-icon="Tray" data-size="24px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                        <path
                          d="M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32Zm0,16V152h-28.7A15.86,15.86,0,0,0,168,156.69L148.69,176H107.31L88,156.69A15.86,15.86,0,0,0,76.69,152H48V48Zm0,160H48V168H76.69L96,187.31A15.86,15.86,0,0,0,107.31,192h41.38A15.86,15.86,0,0,0,160,187.31L179.31,168H208v40Z"
                        ></path>
                      </svg>
                    </div>
                    <p class="text-sm font-medium leading-normal" style="color: var(--text-primary);">Inbox</p>
                  </a>
                  <div class="flex items-center gap-3 px-3 py-2 hoverable cursor-pointer" data-action="help">
                    <div style="color: var(--text-primary);" data-icon="Question" data-size="24px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                        <path
                          d="M140,180a12,12,0,1,1-12-12A12,12,0,0,1,140,180ZM128,72c-22.06,0-40,16.15-40,36v4a8,8,0,0,0,16,0v-4c0-11,10.77-20,24-20s24,9,24,20-10.77,20-24,20a8,8,0,0,0-8,8v8a8,8,0,0,0,16,0v-.72c18.24-3.35,32-17.9,32-35.28C168,88.15,150.06,72,128,72Zm104,56A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"
                        ></path>
                      </svg>
                    </div>
                    <p class="text-sm font-medium leading-normal" style="color: var(--text-primary);">Help</p>
                  </div>
                  <div id="settingsBtn" class="flex items-center gap-3 px-3 py-2 hoverable cursor-pointer">
                    <div style="color: var(--text-primary);" data-icon="Gear" data-size="24px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                        <path
                          d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Zm88-29.84q.06-2.16,0-4.32l14.92-18.64a8,8,0,0,0,1.48-7.06,107.21,107.21,0,0,0-10.88-26.25,8,8,0,0,0-6-3.93l-23.72-2.64q-1.48-1.56-3-3L186,40.54a8,8,0,0,0-3.94-6,107.71,107.71,0,0,0-26.25-10.87,8,8,0,0,0-7.06,1.49L130.16,40Q128,40,125.84,40L107.2,25.11a8,8,0,0,0-7.06-1.48A107.6,107.6,0,0,0,73.89,34.51a8,8,0,0,0-3.93,6L67.32,64.27q-1.56,1.49-3,3L40.54,70a8,8,0,0,0-6,3.94,107.71,107.71,0,0,0-10.87,26.25,8,8,0,0,0,1.49,7.06L40,125.84Q40,128,40,130.16L25.11,148.8a8,8,0,0,0-1.48,7.06,107.21,107.21,0,0,0,10.88,26.25,8,8,0,0,0,6,3.93l23.72,2.64q1.49,1.56,3,3L70,215.46a8,8,0,0,0,3.94,6,107.71,107.71,0,0,0,26.25,10.87,8,8,0,0,0,7.06-1.49L125.84,216q2.16.06,4.32,0l18.64,14.92a8,8,0,0,0,7.06,1.48,107.21,107.21,0,0,0,26.25-10.88,8,8,0,0,0,3.93-6l2.64-23.72q1.56-1.48,3-3L215.46,186a8,8,0,0,0,6-3.94,107.71,107.71,0,0,0,10.87-26.25,8,8,0,0,0-1.49-7.06Zm-16.1-6.5a73.93,73.93,0,0,1,0,8.68,8,8,0,0,0,1.74,5.48l14.19,17.73a91.57,91.57,0,0,1-6.23,15L187,173.11a8,8,0,0,0-5.1,2.64,74.11,74.11,0,0,1-6.14,6.14,8,8,0,0,0-2.64,5.1l-2.51,22.58a91.32,91.32,0,0,1-15,6.23l-17.74-14.19a8,8,0,0,0-5-1.75h-.48a73.93,73.93,0,0,1-8.68,0,8,8,0,0,0-5.48,1.74L100.45,215.8a91.57,91.57,0,0,1-15-6.23L82.89,187a8,8,0,0,0-2.64-5.1,74.11,74.11,0,0,1-6.14-6.14,8,8,0,0,0-5.1-2.64L46.43,170.6a91.32,91.32,0,0,1-6.23-15l14.19-17.74a8,8,0,0,0,1.74-5.48,73.93,73.93,0,0,1,0-8.68,8,8,0,0,0-1.74-5.48L40.2,100.45a91.57,91.57,0,0,1,6.23-15L69,82.89a8,8,0,0,0,5.1-2.64,74.11,74.11,0,0,1,6.14-6.14A8,8,0,0,0,82.89,69L85.4,46.43a91.32,91.32,0,0,1,15-6.23l17.74,14.19a8,8,0,0,0,5.48,1.74,73.93,73.93,0,0,1,8.68,0,8,8,0,0,0,5.48-1.74L155.55,40.2a91.57,91.57,0,0,1,15,6.23L173.11,69a8,8,0,0,0,2.64,5.1,74.11,74.11,0,0,1,6.14,6.14,8,8,0,0,0,5.1,2.64l22.58,2.51a91.32,91.32,0,0,1,6.23,15l-14.19,17.74A8,8,0,0,0,199.87,123.66Z"
                        ></path>
                      </svg>
                    </div>
                    <p class="text-sm font-medium leading-normal" style="color: var(--text-primary);">Settings</p>
                  </div>
                </div>
                </div>
              </div>
            </div>
          </div>
          <div id="mainContent" class="layout-content-container flex flex-col flex-1 ml-6">
            <div class="px-4 py-3">
              <label class="flex flex-col min-w-40 h-12 w-full">
                <div class="search-wrapper flex w-full flex-1 items-stretch h-full rounded-full-important overflow-hidden">
                  <div class="flex border-none items-center justify-center pl-4 pr-2" style="color: var(--text-secondary);">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                      <path
                        d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"
                      ></path>
                    </svg>
                  </div>
                  <input
                    id="searchInput"
                    placeholder="Search courses..."
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden focus:outline-0 focus:ring-0 border-none bg-transparent focus:border-none h-full px-2 pr-4 text-base font-normal leading-normal"
                    style="color: var(--text-primary);"
                    value=""
                  />
                </div>
              </label>
            </div>
            <h2 class="text-[22px] font-bold leading-tight tracking-[-0.015em] px-4 pb-3 pt-5" style="color: var(--text-primary);">Courses</h2>
            <div id="scheduleStatus" class="px-4 pb-3" style="color: var(--text-secondary); font-size: 14px;">
              <div id="currentTime"></div>
              <div id="currentPeriod"></div>
                  </div>
            <div id="coursesContainer">
              <!-- Courses will be dynamically loaded here -->
                </div>
            <div class="add-class-btn" id="addClassBtn">
              <div style="font-size: 24px; margin-bottom: 8px;">+</div>
              <div style="font-weight: 500;">Add New Class</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      (function () {
        const toggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        const sidebarContent = document.getElementById('sidebarContent');
        const mainContent = document.getElementById('mainContent');
        if (!toggle || !sidebar) return;

        // --- Sidebar open/close for mobile ---
        function openSidebar() { sidebar.classList.add('open'); if (overlay) overlay.classList.remove('hidden'); }
        function closeSidebar() { sidebar.classList.remove('open'); if (overlay) overlay.classList.add('hidden'); }
        toggle.addEventListener('click', function () { if (sidebar.classList.contains('open')) closeSidebar(); else openSidebar(); });
        if (overlay) overlay.addEventListener('click', closeSidebar);
        document.addEventListener('keydown', function (e) { if (e.key === 'Escape') closeSidebar(); });
        window.addEventListener('resize', function () { if (window.innerWidth > 768) { sidebar.classList.remove('open'); if (overlay) overlay.classList.add('hidden'); } });

        // --- Authentication System ---
        function checkAuthentication() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            
            if (!isLoggedIn || !currentUser) {
                showLoginPopup();
                return false;
            }
            
            return true;
        }

        function showLoginPopup() {
            const popup = document.createElement('div');
            popup.id = 'loginPopup';
            popup.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            popup.innerHTML = `
                <div style="background-color: var(--bg-primary); border-radius: 12px; padding: 24px; max-width: 400px; width: 90%;">
                    <h3 style="color: var(--text-primary); font-size: 20px; font-weight: bold; margin-bottom: 16px; text-align: center;">Welcome to FastDash</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 24px; text-align: center;">Please sign in to access your dashboard</p>
                    
                    <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                        <button id="loginBtn" style="flex: 1; padding: 12px; border-radius: 8px; background-color: var(--accent); color: white; border: none; font-weight: 500;">Sign In</button>
                        <button id="signupBtn" style="flex: 1; padding: 12px; border-radius: 8px; background-color: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--bg-hover); font-weight: 500;">Sign Up</button>
                    </div>
                    
                    <div style="text-align: center;">
                        <button id="demoBtn" style="padding: 8px 16px; border-radius: 6px; background-color: transparent; color: var(--accent); border: 1px solid var(--accent); font-size: 14px;">Try Demo</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            // Add event listeners
            document.getElementById('loginBtn').addEventListener('click', () => {
                window.location.href = 'login.html';
            });
            
            document.getElementById('signupBtn').addEventListener('click', () => {
                window.location.href = 'signup.html';
            });
            
            document.getElementById('demoBtn').addEventListener('click', () => {
                // Demo login
                const demoUser = {
                    id: 'demo',
                    email: 'demo@student.com',
                    name: 'Demo Student',
                    isDemo: true
                };
                
                localStorage.setItem('currentUser', JSON.stringify(demoUser));
                localStorage.setItem('isLoggedIn', 'true');
                
                popup.remove();
                updateUserInterface();
            });
        }

        function updateUserInterface() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (currentUser) {
                // Update user name in sidebar
                const userNameEl = document.querySelector('h1');
                if (userNameEl) {
                    userNameEl.textContent = currentUser.name;
                }
                
                // Load user-specific settings
                loadUserSettings();
                updateUserIcon();
            }
        }

        function loadUserSettings() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (currentUser && currentUser.settings) {
                const { theme, customColor } = currentUser.settings;
                applyTheme(theme, customColor);
            }
        }

        function saveUserSettings(theme, customColor, userIconColor) {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (currentUser) {
                currentUser.settings = {
                    theme: theme,
                    customColor: customColor,
                    userIconColor: userIconColor
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
        }

        function updateUserIcon() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            const userIconContainer = document.getElementById('userIconContainer');
            if (!userIconContainer) return;

            let iconColor = '#4b7cff'; // Default color

            if (currentUser && currentUser.settings && currentUser.settings.userIconColor) {
                iconColor = currentUser.settings.userIconColor;
            } else if (currentUser) {
                // If no color is set, generate a random one and save it
                iconColor = '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
                saveUserSettings(
                    currentUser.settings?.theme || 'dark',
                    currentUser.settings?.customColor || '#111118',
                    iconColor
                );
            }

            userIconContainer.style.backgroundColor = iconColor;
        }

        function logout() {
          localStorage.removeItem('currentUser');
          localStorage.removeItem('isLoggedIn');
          window.location.reload();
        }

        // --- Class Management System ---
        function getDefaultClasses() {
          return [
            { id: '1', name: 'New Class', description: 'Home Page', homeLink: '', modulesLink: '', tags: ['1'], color: '', image: 'https://lh3.googleusercontent.com/aida-public/AB6AXuBjHagyVzYyufMez6F9-q3RMBtNr1-wOuY5sWqgjfyGfWVfHAjtuZNdB5tC852Iz0O3lxjBuCJVAP5kJpqNUQ82GjJJMVl8Dj1RbpeZallkRk4jDXyRLZmNHJT3xlRnfyWKsqhMqrqSfKccMgMkqEo1ATddOnwEygdQuTqwnccuQeDOVyoBOdxYmHRJsopjam6_778WCR66alx5nbeQ8uIwlurMrCgaoP7vfO4tNi2jCdIhQZWR4nNRAUvgvdsTlujLjtbtdILetTA' },
            { id: '2', name: 'New Class', description: 'Home Page', homeLink: '', modulesLink: '', tags: ['2'], color: '', image: 'https://lh3.googleusercontent.com/aida-public/AB6AXuCKXAs5OteKedmmPDXpMUR29RvdI0KFdy0XqBvxEbCyBZuyAk17SvC69rTXt8UbihPKJcWeeuN_i4u7k8J_PjIkx2XPpjwa-W_OCCBfxI6XT815aB4ZfI5dao4IkRf3nl3njts91Sie4Y1yWAlooUUOdvqf6xyjEzQ3pmbacuKYrUiQFmWRoivvGppVgtxcoi1ks_3woUK_Bq-B9K51m7iSxZ9CkIVVrnbGoH-1GxUChZFNeclcb0WjuxhJYWMMnbZYHlIGbfGuZgY' },
            { id: '3', name: 'New Class', description: 'Home Page', homeLink: '', modulesLink: '', tags: ['3'], color: '', image: 'https://lh3.googleusercontent.com/aida-public/AB6AXuBVPQXw7QUkMRrvUYJzJ9npEqDx1q8l0APgDiv1DwmhqluPGWlqr6u50byf6byX7d70Ba0eE8Jkfivb4TdJN053ladqljGjSZIu1BkubEtQkzE0LWlc_pu1ta4pA11fRtspOa5FQxxL0OowBC7d55n7-zH908D6-eNBXkLCul8p9x71AKbeRqHNawEELyRRdaZ97JHS84Sq-U7rzoA17GpuFRN40WU8oGtY7lO24rxYdnfCBdVMPMRStqJoL4LrM07WPWKwtJC35f8' },
            { id: '4', name: 'New Class', description: 'Home Page', homeLink: '', modulesLink: '', tags: ['4'], color: '', image: 'https://lh3.googleusercontent.com/aida-public/AB6AXuCPm7Eke5uK2N1ONwsWa7yY4AMJmHtSmvpu81WnSGbgz0SYwoNGdIiN9y-5xXb5-PTMT4bgKlstX9sJxx6KdqYGkV4K6xvBTggYM9V1b_QHE4PuYbBDvJVXcb7C83kI1tCnOzpD1UdMpzWgwl_J8JYfsJm25IgM0d9cGEW5JiTmctXE3h-lyvQfrt7eULwRr7CYDvimWbFrx7Kvd1BezbixDNcCXEWqt6Fg0x1-mU0xtHU-s7ikmtmrvFTyHbSt3Hfjm7JXjZRL1sI' },
            { id: '5', name: 'New Class', description: 'Home Page', homeLink: '', modulesLink: '', tags: ['5'], color: '', image: 'https://lh3.googleusercontent.com/aida-public/AB6AXuDogXl3CcofBteevP0Pt914hI0LBQu0TiSk-xFkgYWOahwnGgaSB6C6FgZCNS-B1nP0A59LZ4G2eNFqXZs0jtDOFh38PZgPxPjISqMsIcNrYr5tURx8qy-l4vFKuDUELlfxX62iFzso81pTrpTflaCx1Ipvtpy4x4HRSx0YqXvbz-hy-o2fyGcAtEQ1JZkHGMDhuttPtHOLoymJuFNfsmkiOSe_a_DomajXkmdy-NXHzTT1MloNQ26tVLx0QMl0A1RWBJaiLetjcjQ' },
            { id: '6', name: 'New Class', description: 'Home Page', homeLink: '', modulesLink: '', tags: ['6'], color: '', image: 'https://lh3.googleusercontent.com/aida-public/AB6AXuA09PPKJzH3nVoLfr_rkHfcjTjIXonZFivla-p2fgUBOg-Gr1H6pwaWOFOY0jBbIs4xm9d5lc4FfjoN-i5N7vTAygv584UoBrDwGsPQjgM7qsUuOz6vQs5logsDSLNvEMFspc-ZMI2Ay70O2sch3_tLYJfQ6NB3ceBtPt_m2GMVamoKoxS9Dc2f_nJIrQYK4PF_N3NY0CRlppiaUFsbYK_dM2hlEvhhvCihPOXy_sXN3xqDEMwlWJDS9Enmm_dULn5mICPPvns3i5o' },
            { id: '7', name: 'New Class', description: 'Home Page', homeLink: '', modulesLink: '', tags: ['7'], color: '', image: 'https://lh3.googleusercontent.com/aida-public/AB6AXuAhHxvV4a08hP7e45w3TYsoMOqY6zvaow9oMTjNbcuBz-OT7LLbRMhitdNiAcRtm0Nr9QgNBWYwogSkiT5xPho0Pd9CR3YRbI8aY4ZwlsxfcYiZOOB3dWpW5c4G0ZtJ_RLigvY4Ssl7-XyKdvTfaTzJneLiJ9BnZdVbXKAqs8FRu_4pORW3cocSs0u8K4FY9r_6ssjjvjwb0XswckIebYcTkOcXBHYyQ8Z6Cf-ccO5USrOh1rt_Zkv1S4eUPXveLcLTt6xb9t-eRwU' }
          ];
        }

        function getUserClasses() {
          const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
          if (!currentUser) return getDefaultClasses();
          
          const userClasses = localStorage.getItem(`userClasses_${currentUser.id}`);
          if (!userClasses) {
            // Initialize with default classes for new users
            const defaultClasses = getDefaultClasses();
            saveUserClasses(defaultClasses);
            return defaultClasses;
          }
          
          return JSON.parse(userClasses);
        }

        function saveUserClasses(classes) {
          const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
          if (!currentUser) return;
          
          localStorage.setItem(`userClasses_${currentUser.id}`, JSON.stringify(classes));
        }

        function renderClasses() {
          const classes = getUserClasses();
          const container = document.getElementById('coursesContainer');
          
          container.innerHTML = classes.map(cls => `
            <div class="p-4 course-card" data-class-id="${cls.id}">
              <div class="flex items-stretch justify-between gap-4 rounded-lg">
                <div class="flex flex-[2_2_0px] flex-col gap-4">
                  <div class="flex flex-col gap-1">
                    <p class="course-title text-base font-bold leading-tight">${cls.name}</p>
                    <p class="course-description text-sm font-normal leading-normal">${cls.description}</p>
                    ${cls.tags.length > 0 ? `<div class="flex gap-1 mt-1">${cls.tags.map(tag => `<span class="px-2 py-1 text-xs rounded" style="background-color: var(--bg-secondary); color: var(--text-secondary);">${tag}</span>`).join('')}</div>` : ''}
                  </div>
                  <div class="flex gap-2">
                    ${cls.homeLink ? `<a href="${cls.homeLink}" target="_blank" class="module-button flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-8 px-4 flex-row-reverse text-sm font-medium leading-normal w-fit"><span class="truncate">Home</span></a>` : ''}
                    ${cls.modulesLink ? `<a href="${cls.modulesLink}" target="_blank" class="module-button flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-8 px-4 flex-row-reverse text-sm font-medium leading-normal w-fit"><span class="truncate">Modules</span></a>` : ''}
                  </div>
                </div>
                <div class="w-full aspect-video bg-cover rounded-lg flex-1 relative" style="background-image: url('${cls.image || ''}'); background-color: ${cls.image ? 'transparent' : 'white'};">
                  ${cls.color ? `<div class="color-tint" style="background-color: ${cls.color}40;"></div>` : ''}
                </div>
              </div>
              <div class="edit-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="m18.5 2.5 a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
            </div>
          `).join('');

          // Add event listeners to the edit icons
          const editIcons = container.querySelectorAll('.edit-icon');
          editIcons.forEach(icon => {
            const card = icon.closest('.course-card');
            if (card) {
              const classId = card.getAttribute('data-class-id');
              if (classId) {
                icon.addEventListener('click', () => openClassEditor(classId));
              }
            }
          });
        }

        function openClassEditor(classId = null) {
          const classes = getUserClasses();
          const editingClass = classId ? classes.find(c => c.id === classId) : null;
          
          const modal = document.createElement('div');
          modal.id = 'classEditorModal';
          modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
          `;
          
          modal.innerHTML = `
            <div style="background-color: var(--bg-primary); border-radius: 12px; padding: 24px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
              <h3 style="color: var(--text-primary); font-size: 20px; font-weight: bold; margin-bottom: 20px; text-align: center;">
                ${editingClass ? 'Edit Class' : 'Add New Class'}
              </h3>
              
              <form id="classEditorForm" class="space-y-4">
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">
                    Class Name
                    <span class="help-icon" title="The name of your class (e.g., Math 101, Science)">i</span>
                  </label>
                  <input type="text" id="className" required class="w-full px-3 py-2 rounded-lg" style="background-color: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--bg-hover);" placeholder="Enter class name" value="${editingClass ? editingClass.name : ''}">
                </div>
                
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">
                    Description
                    <span class="help-icon" title="A short description that appears under the class name">i</span>
                  </label>
                  <input type="text" id="classDescription" class="w-full px-3 py-2 rounded-lg" style="background-color: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--bg-hover);" placeholder="Enter description" value="${editingClass ? editingClass.description : ''}">
                </div>
                
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">
                    Tags
                    <span class="help-icon" title="Comma-separated tags for searching (e.g., math, algebra, homework)">i</span>
                  </label>
                  <input type="text" id="classTags" class="w-full px-3 py-2 rounded-lg" style="background-color: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--bg-hover);" placeholder="Enter tags separated by commas" value="${editingClass ? editingClass.tags.join(', ') : ''}">
                </div>
                
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">
                    Home Page Link
                    <span class="help-icon" title="URL to your class homepage or main content">i</span>
                  </label>
                  <input type="url" id="classHomeLink" class="w-full px-3 py-2 rounded-lg" style="background-color: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--bg-hover);" placeholder="https://example.com/home" value="${editingClass ? editingClass.homeLink : ''}">
                </div>
                
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">
                    Modules Link
                    <span class="help-icon" title="URL to your class modules or assignments">i</span>
                  </label>
                  <input type="url" id="classModulesLink" class="w-full px-3 py-2 rounded-lg" style="background-color: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--bg-hover);" placeholder="https://example.com/modules" value="${editingClass ? editingClass.modulesLink : ''}">
                </div>
                
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">
                    Color Tint
                    <span class="help-icon" title="A color overlay for the class image (leave blank for no tint)">i</span>
                  </label>
                  <input type="color" id="classColor" class="w-full h-10 rounded-lg" value="${editingClass ? editingClass.color : '#4b7cff'}">
                </div>
                
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">
                    Background Image URL
                    <span class="help-icon" title="URL to an image for your class (leave blank for white background)">i</span>
                  </label>
                  <input type="url" id="classImage" class="w-full px-3 py-2 rounded-lg" style="background-color: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--bg-hover);" placeholder="https://example.com/image.jpg" value="${editingClass ? editingClass.image : ''}">
                </div>
                
                <div class="flex justify-end gap-2 mt-6">
                  <button type="button" id="cancelClassEdit" class="px-4 py-2 rounded transition-colors" style="background-color: var(--bg-secondary); color: var(--text-primary);">Cancel</button>
                  ${editingClass ? `<button type="button" id="deleteClass" class="px-4 py-2 rounded transition-colors" style="background-color: #ff6b6b; color: white;">Delete</button>` : ''}
                  <button type="submit" class="px-4 py-2 rounded transition-colors" style="background-color: var(--accent); color: white;">${editingClass ? 'Save Changes' : 'Create Class'}</button>
                </div>
              </form>
            </div>
          `;
          
          document.body.appendChild(modal);
          
          // Add event listeners
          document.getElementById('cancelClassEdit').addEventListener('click', () => {
            modal.remove();
          });
          
          if (editingClass) {
            document.getElementById('deleteClass').addEventListener('click', () => {
              if (confirm('Are you sure you want to delete this class?')) {
                const updatedClasses = classes.filter(c => c.id !== classId);
                saveUserClasses(updatedClasses);
                renderClasses();
                modal.remove();
              }
            });
          }
          
          document.getElementById('classEditorForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const formData = {
              name: document.getElementById('className').value,
              description: document.getElementById('classDescription').value,
              tags: document.getElementById('classTags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
              homeLink: document.getElementById('classHomeLink').value,
              modulesLink: document.getElementById('classModulesLink').value,
              color: document.getElementById('classColor').value,
              image: document.getElementById('classImage').value
            };
            
            if (editingClass) {
              // Update existing class
              const updatedClasses = classes.map(c => 
                c.id === classId ? { ...c, ...formData } : c
              );
              saveUserClasses(updatedClasses);
            } else {
              // Create new class
              const newClass = {
                id: Date.now().toString(),
                ...formData
              };
              const updatedClasses = [...classes, newClass];
              saveUserClasses(updatedClasses);
            }
            
            renderClasses();
            modal.remove();
          });
        }

        // --- Schedule management ---
        const SCHEDULE_DATA = {
          // Monday, Tuesday, Friday
          'MTF': {
            'Period 1': { start: '08:10', end: '08:55' },
            'Period 2': { start: '09:15', end: '10:00' },
            'Period 3': { start: '10:05', end: '10:50' },
            'Period 4': { start: '10:55', end: '11:40' },
            'Period 5': { start: '11:45', end: '12:30' }, // 8th grade
            'Period 6': { start: '13:15', end: '14:00' },
            'Period 7': { start: '14:05', end: '14:50' }
          },
          // Wednesday (Even blocks)
          'W': {
            'Period 2': { start: '08:10', end: '09:25' },
            'Period 4': { start: '10:15', end: '11:30' },
            'Period 6': { start: '12:45', end: '14:00' }
          },
          // Thursday (Odd blocks)
          'TH': {
            'Period 1': { start: '08:10', end: '09:25' },
            'Period 3': { start: '09:45', end: '11:00' },
            'Period 5': { start: '12:15', end: '13:30' },
            'Period 7': { start: '13:35', end: '14:50' }
          }
        };

        function getCurrentSchedule() {
          const now = new Date();
          const dayOfWeek = now.getDay(); // 0 = Sunday, 1 = Monday, etc.
          const currentTime = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
          
          let scheduleKey;
          if (dayOfWeek === 1 || dayOfWeek === 2 || dayOfWeek === 5) { // Monday, Tuesday, Friday
            scheduleKey = 'MTF';
          } else if (dayOfWeek === 3) { // Wednesday
            scheduleKey = 'W';
          } else if (dayOfWeek === 4) { // Thursday
            scheduleKey = 'TH';
          } else {
            return null; // Weekend or unscheduled day
          }
          
          return { schedule: SCHEDULE_DATA[scheduleKey], currentTime };
        }

        function getCurrentPeriod() {
          const scheduleInfo = getCurrentSchedule();
          if (!scheduleInfo) return null;
          
          const { schedule, currentTime } = scheduleInfo;
          
          for (const [period, times] of Object.entries(schedule)) {
            if (currentTime >= times.start && currentTime <= times.end) {
              return period;
            }
          }
          
          return null; // Between periods
        }

        function updateCourseDisplay() {
          const currentPeriod = getCurrentPeriod();
          const scheduleInfo = getCurrentSchedule();
          const courseCards = document.querySelectorAll('.course-card');
          const classes = getUserClasses();
          
          // Update status display
          const currentTimeEl = document.getElementById('currentTime');
          const currentPeriodEl = document.getElementById('currentPeriod');
          
          if (currentTimeEl) {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
              hour: '2-digit', 
              minute: '2-digit',
              hour12: true 
            });
            currentTimeEl.textContent = `Current Time: ${timeString}`;
          }
          
          if (currentPeriodEl) {
            if (currentPeriod) {
              currentPeriodEl.textContent = `Current Period: ${currentPeriod}`;
              currentPeriodEl.style.color = 'var(--accent)';
            } else {
              currentPeriodEl.textContent = 'Between periods';
              currentPeriodEl.style.color = 'var(--text-secondary)';
            }
          }
          
          const currentPeriodNumber = currentPeriod ? currentPeriod.replace('Period ', '') : null;

          courseCards.forEach(card => {
            const classId = card.getAttribute('data-class-id');
            if (!classId) return;

            const classData = classes.find(c => c.id === classId);
            if (!classData) return;
            
            const isCurrentPeriod = currentPeriodNumber && classData.tags.includes(currentPeriodNumber);
            
            if (isCurrentPeriod) {
              card.style.display = 'block';
              card.style.opacity = '1';
              card.style.transform = 'scale(1.02)';
              card.style.border = '2px solid var(--accent)';
              card.style.borderRadius = '12px';
              card.style.backgroundColor = 'var(--bg-hover)';
              card.style.transition = 'all 0.3s ease';
              
              // Add current period indicator
              let indicator = card.querySelector('.current-period-indicator');
              if (!indicator) {
                indicator = document.createElement('div');
                indicator.className = 'current-period-indicator';
                indicator.style.cssText = `
                  position: absolute;
                  top: 8px;
                  right: 8px;
                  background: var(--accent);
                  color: white;
                  padding: 4px 8px;
                  border-radius: 12px;
                  font-size: 12px;
                  font-weight: bold;
                  z-index: 10;
                `;
                indicator.textContent = 'NOW';
                card.style.position = 'relative';
                card.appendChild(indicator);
              }
            } else {
              card.style.display = 'block';
              card.style.opacity = '1';
              card.style.transform = 'scale(1)';
              card.style.border = 'none';
              card.style.backgroundColor = 'transparent';
              card.style.transition = 'all 0.3s ease';
              
              // Remove current period indicator
              const indicator = card.querySelector('.current-period-indicator');
              if (indicator) {
                indicator.remove();
              }
            }
          });
        }

        // --- Theme management ---
        const THEME_KEY = 'dashboardTheme';
        const CUSTOM_COLOR_KEY = 'dashboardCustomColor';
        
        function applyTheme(theme, customColor = null) {
          document.body.className = document.body.className.replace(/theme-\w+/g, '');
          document.body.classList.add(`theme-${theme}`);
          
          if (theme === 'custom' && customColor) {
            const colors = generateColorPalette(customColor);
            document.documentElement.style.setProperty('--custom-bg-primary', colors.bgPrimary);
            document.documentElement.style.setProperty('--custom-bg-secondary', colors.bgSecondary);
            document.documentElement.style.setProperty('--custom-bg-hover', colors.bgHover);
            document.documentElement.style.setProperty('--custom-text-primary', colors.textPrimary);
            document.documentElement.style.setProperty('--custom-text-secondary', colors.textSecondary);
            document.documentElement.style.setProperty('--custom-accent', colors.accent);
          }
        }
        
        function generateColorPalette(baseColor) {
          // Convert hex to RGB
          const hex = baseColor.replace('#', '');
          const r = parseInt(hex.substr(0, 2), 16);
          const g = parseInt(hex.substr(2, 2), 16);
          const b = parseInt(hex.substr(4, 2), 16);
          
          // Generate lighter and darker variants
          const lighten = (color, amount) => Math.min(255, color + amount);
          const darken = (color, amount) => Math.max(0, color - amount);
          
          return {
            bgPrimary: `rgb(${darken(r, 20)}, ${darken(g, 20)}, ${darken(b, 20)})`,
            bgSecondary: `rgb(${r}, ${g}, ${b})`,
            bgHover: `rgb(${lighten(r, 20)}, ${lighten(g, 20)}, ${lighten(b, 20)})`,
            textPrimary: r + g + b > 384 ? '#000000' : '#ffffff',
            textSecondary: r + g + b > 384 ? '#666666' : '#9d9db8',
            accent: '#4b7cff'
          };
        }
        
        function loadSavedTheme() {
          const savedTheme = localStorage.getItem(THEME_KEY) || 'dark';
          const savedCustomColor = localStorage.getItem(CUSTOM_COLOR_KEY) || '#111118';
          applyTheme(savedTheme, savedCustomColor);
          return { theme: savedTheme, customColor: savedCustomColor };
        }

        // --- History of visited classes (last 6) ---
        const HISTORY_KEY = 'classHistory';
        function getHistory() { try { return JSON.parse(localStorage.getItem(HISTORY_KEY)) || []; } catch (e) { return []; } }
        function saveHistory(arr) { localStorage.setItem(HISTORY_KEY, JSON.stringify(arr)); }
        function addHistory(name) {
          if (!name) return;
          const list = getHistory().filter(x => x !== name);
          list.unshift(name);
          while (list.length > 6) list.pop();
          saveHistory(list);
        }

        // --- Sidebar content swapping ---
        const initialSidebarHTML = sidebarContent ? sidebarContent.innerHTML : '';

        function renderDefaultSidebar() {
          if (!sidebarContent) return;
          sidebarContent.innerHTML = initialSidebarHTML;
        }

        function renderCoursesList() {
          if (!sidebarContent || !mainContent) return;
          // find course titles in main content
          const nodes = Array.from(mainContent.querySelectorAll('p.course-title'));
          const titles = nodes.map(n => n.textContent.trim()).filter(Boolean);

          let content = `
            <div class="flex items-center justify-between px-2 pb-2">
              <div class="text-sm" style="color: var(--text-secondary);">Your courses</div>
              <button class="px-2" style="color: var(--text-primary);" data-back>Leave</button>
            </div>
          `;

          if (titles.length === 0) {
            content += '<div class="px-3 text-sm" style="color: var(--text-secondary);">No courses found</div>';
          } else {
            content += titles.map(t => `<button class="w-full text-left px-3 py-2 hoverable" style="color: var(--text-primary);" data-course="${encodeURIComponent(t)}">${t}</button>`).join('');
          }

          sidebarContent.innerHTML = content;
        }

        function renderHistoryList() {
          if (!sidebarContent) return;
          const list = getHistory();
          if (!list || list.length === 0) {
            sidebarContent.innerHTML = '<div class="px-3 text-sm" style="color: var(--text-secondary);">No recent classes</div>';
            return;
          }
          sidebarContent.innerHTML = `
            <div class="flex items-center justify-between px-2 pb-2">
              <div class="text-sm" style="color: var(--text-secondary);">Recent classes</div>
              <button class="px-2" style="color: var(--text-primary);" data-back>✕</button>
            </div>
          ` + list.map(t => `<button class="w-full text-left px-3 py-2 hoverable" style="color: var(--text-primary);" data-course="${encodeURIComponent(t)}">${t}</button>`).join('');
        }

        function renderHelpSection() {
          if (!sidebarContent) return;

          const helpContent = [
            { q: 'How do I add a new class?', a: 'Click the "+ Add New Class" button on the dashboard to open the class editor.' },
            { q: 'How do I edit or delete a class?', a: 'Hover over a class card and click the pencil icon that appears in the top-right corner.' },
            { q: 'How does the schedule highlighting work?', a: 'The app automatically highlights the current class based on a pre-defined schedule. This requires classes to have a numeric tag (1-7) corresponding to the period.' },
            { q: 'How do I customize the theme?', a: 'Click the "Settings" button in the sidebar to open the settings modal, where you can change the theme and colors.' },
            { q: 'How do I change my name or icon color?', a: 'You can change your display name and icon color in the "Settings" modal.' },
            { q: 'How do I search for a class?', a: 'Use the search bar at the top of the main content area to filter your classes by name, description, or tags.' }
          ];

          let content = `
            <div class="flex items-center justify-between px-2 pb-2">
              <div class="text-sm" style="color: var(--text-secondary);">Help Center</div>
              <button class="px-2" style="color: var(--text-primary);" data-back>Leave</button>
            </div>
            <div class="px-1 pb-2">
              <input type="text" id="helpSearch" placeholder="Search help..." class="w-full px-3 py-2 rounded-lg text-sm" style="background-color: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--bg-hover);">
            </div>
            <div id="helpContent" class="flex flex-col gap-2 px-1 overflow-y-auto" style="max-height: calc(100vh - 200px);">
              ${helpContent.map(item => `
                <div class="help-item p-2 rounded-lg" style="background-color: var(--bg-secondary);">
                  <p class="font-semibold text-sm" style="color: var(--text-primary);">${item.q}</p>
                  <p class="text-xs pt-1" style="color: var(--text-secondary);">${item.a}</p>
                </div>
              `).join('')}
            </div>
          `;

          sidebarContent.innerHTML = content;

          // Add search functionality
          const helpSearchInput = document.getElementById('helpSearch');
          if (helpSearchInput) {
            helpSearchInput.addEventListener('input', function(e) {
              const searchTerm = e.target.value.toLowerCase();
              const helpItems = document.querySelectorAll('#helpContent .help-item');
              helpItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                  item.style.display = 'block';
                } else {
                  item.style.display = 'none';
                }
              });
            });
          }
        }

        // delegate clicks inside sidebarContent (use delegation so handlers survive DOM replacements)
        sidebarContent && sidebarContent.addEventListener('click', function (e) {
          // back button (X)
          const back = e.target.closest('[data-back]');
          if (back) { renderDefaultSidebar(); return; }

          // actions: courses / history / dashboard
          const btn = e.target.closest('[data-action]');
          if (btn) {
            const action = btn.getAttribute('data-action');
            if (action === 'courses') renderCoursesList();
            else if (action === 'history') renderHistoryList();
            else if (action === 'help') renderHelpSection();
            else if (action === 'dashboard') renderDefaultSidebar();
            return;
          }

          // settings (button may be recreated) — handled here
          const settings = e.target.closest('#settingsBtn');
          if (settings) { openSettingsModal(); return; }

          // course buttons
          const courseBtn = e.target.closest('[data-course]');
          if (courseBtn) {
            const name = decodeURIComponent(courseBtn.getAttribute('data-course'));
            addHistory(name);
            // try to scroll to the course card in main content
            const nodes = Array.from(mainContent.querySelectorAll('p.course-title'));
            const target = nodes.find(n => n.textContent.trim() === name);
            if (target) target.scrollIntoView({ behavior: 'smooth', block: 'center' });
            // after selection, go back to default sidebar view
            renderDefaultSidebar();
            return;
          }
        });


        // --- Settings modal handling ---
        function openSettingsModal() {
          let modal = document.getElementById('settingsModal');
          if (!modal) return;
          
          // Get user settings instead of global settings
          const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
          const userSettings = currentUser?.settings || { theme: 'dark', customColor: '#111118', userIconColor: '#4b7cff' };
          
          // Set radio button
          const themeRadios = modal.querySelectorAll('input[name="theme"]');
          themeRadios.forEach(radio => {
            radio.checked = radio.value === userSettings.theme;
          });
          
          // Set custom color inputs
          const customColorInput = modal.querySelector('#customColorInput');
          const customColorText = modal.querySelector('#customColorText');
          const customColorSection = modal.querySelector('#customColorSection');
          
          if (customColorInput && customColorText) {
            customColorInput.value = userSettings.customColor;
            customColorText.value = userSettings.customColor;
          }

          // Set user icon color inputs
          const userIconColorInput = modal.querySelector('#userIconColorInput');
          const userIconColorText = modal.querySelector('#userIconColorText');

          if (userIconColorInput && userIconColorText) {
              userIconColorInput.value = userSettings.userIconColor;
              userIconColorText.value = userSettings.userIconColor;
          }
          
          // Show/hide custom color section
          if (customColorSection) {
            customColorSection.classList.toggle('hidden', userSettings.theme !== 'custom');
          }
          
          modal.classList.remove('hidden');
        }

        function closeSettingsModal() {
          const modal = document.getElementById('settingsModal');
          if (modal) modal.classList.add('hidden');
        }

        function saveSettings() {
          const modal = document.getElementById('settingsModal');
          if (!modal) return;
          
          const selectedTheme = modal.querySelector('input[name="theme"]:checked').value;
          const customColorInput = modal.querySelector('#customColorInput');
          const customColor = customColorInput ? customColorInput.value : '#111118';
          const userIconColorInput = modal.querySelector('#userIconColorInput');
          const userIconColor = userIconColorInput ? userIconColorInput.value : '#4b7cff';
          
          // Save to user settings instead of global localStorage
          saveUserSettings(selectedTheme, customColor, userIconColor);
          
          applyTheme(selectedTheme, customColor);
          updateUserIcon();
          closeSettingsModal();
        }

        // Handle theme radio changes
        document.addEventListener('change', function(e) {
          if (e.target.name === 'theme') {
            const customColorSection = document.getElementById('customColorSection');
            if (customColorSection) {
              customColorSection.classList.toggle('hidden', e.target.value !== 'custom');
            }
          }
        });

        // Handle custom color input changes
        document.addEventListener('input', function(e) {
          if (e.target.id === 'customColorInput') {
            const textInput = document.getElementById('customColorText');
            if (textInput) textInput.value = e.target.value;
          } else if (e.target.id === 'customColorText') {
            const colorInput = document.getElementById('customColorInput');
            if (colorInput && /^#[0-9A-F]{6}$/i.test(e.target.value)) {
              colorInput.value = e.target.value;
            }
          } else if (e.target.id === 'userIconColorInput') {
            const textInput = document.getElementById('userIconColorText');
            if (textInput) textInput.value = e.target.value;
          } else if (e.target.id === 'userIconColorText') {
            const colorInput = document.getElementById('userIconColorInput');
            if (colorInput && /^#[0-9A-F]{6}$/i.test(e.target.value)) {
              colorInput.value = e.target.value;
            }
          }
        });

        // hook modal buttons
        document.addEventListener('click', function (e) {
          const t = e.target;
          if (t.matches('#settingsCancel')) closeSettingsModal();
          if (t.matches('#settingsSave')) saveSettings();
          if (t.matches('#logoutBtn')) logout();
          if (t.matches('#changeDisplayNameBtn')) changeDisplayName();
          if (t.matches('#deleteAccountBtn')) deleteAccount();
          if (t.matches('#settingsModal') && e.target.id === 'settingsModal') closeSettingsModal();
        });

        function changeDisplayName() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (!currentUser) return;

            const newName = prompt('Enter your new display name:', currentUser.name);
            if (newName && newName.trim() !== '') {
                currentUser.name = newName.trim();
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserInterface();
            }
        }

        function deleteAccount() {
            if (confirm('Are you sure you want to delete your account? This will remove all your classes and settings.')) {
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
                if (currentUser) {
                    localStorage.removeItem(`userClasses_${currentUser.id}`);
                }
                logout();
            }
        }

        // attach course module button listeners so clicking modules records history
        if (mainContent) {
          const titleEls = Array.from(mainContent.querySelectorAll('p.course-title'));
          titleEls.forEach(title => {
            const wrapper = title.closest('.p-4');
            const btn = wrapper && wrapper.querySelector('button');
            if (btn) btn.addEventListener('click', function () { addHistory(title.textContent.trim()); });
          });
        }


        // --- Search functionality ---
        const searchInput = document.getElementById('searchInput');
        const courseCards = Array.from(document.querySelectorAll('.p-4')).filter(card => {
          const title = card.querySelector('p.course-title');
          return title && title.textContent.trim();
        });

        function filterCourses(searchTerm) {
          const term = searchTerm.toLowerCase().trim();
          const courseCards = document.querySelectorAll('.course-card');
          
          courseCards.forEach(card => {
            const title = card.querySelector('p.course-title');
            const description = card.querySelector('p.course-description');
            const tags = card.querySelectorAll('span');
            
            const courseName = title ? title.textContent.toLowerCase() : '';
            const courseDescription = description ? description.textContent.toLowerCase() : '';
            const courseTags = Array.from(tags).map(tag => tag.textContent.toLowerCase()).join(' ');
            
            const searchableText = `${courseName} ${courseDescription} ${courseTags}`;
            
            if (term === '' || searchableText.includes(term)) {
              card.style.display = 'block';
            } else {
              card.style.display = 'none';
            }
          });
        }

        if (searchInput) {
          searchInput.addEventListener('input', function(e) {
            filterCourses(e.target.value);
          });
        }

        // initialize: check authentication and load user interface
        if (checkAuthentication()) {
          updateUserInterface();
        renderDefaultSidebar();
          renderClasses();
          
          // Initialize schedule system
          updateCourseDisplay();
          
          // Update schedule every minute
          setInterval(updateCourseDisplay, 60000);
          
          // Add event listener for add class button
          document.getElementById('addClassBtn').addEventListener('click', () => {
            openClassEditor();
          });
        }
      })();
    </script>

    <!-- Settings modal -->
    <div id="settingsModal" class="hidden fixed inset-0 z-70 flex items-center justify-center bg-black bg-opacity-40">
      <div class="rounded-lg p-6 w-[400px]" style="background-color: var(--bg-primary);">
        <h3 class="text-lg mb-4" style="color: var(--text-primary);">Settings</h3>
        
        <!-- Interface Section -->
        <div class="mb-6">
          <h4 class="text-md mb-3 font-semibold" style="color: var(--text-primary);">Interface</h4>
          <label class="text-sm mb-3 block" style="color: var(--text-secondary);">Theme</label>
          <div class="space-y-2">
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="radio" name="theme" value="dark" class="theme-radio" checked>
              <span class="text-sm" style="color: var(--text-primary);">Dark Mode</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="radio" name="theme" value="light" class="theme-radio">
              <span class="text-sm" style="color: var(--text-primary);">Light Mode</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="radio" name="theme" value="custom" class="theme-radio">
              <span class="text-sm" style="color: var(--text-primary);">Custom Color</span>
            </label>
          </div>
        </div>

        <!-- Custom Color Picker -->
        <div id="customColorSection" class="mb-6 hidden">
          <label class="text-sm mb-2 block" style="color: var(--text-secondary);">Custom Color</label>
          <div class="flex items-center gap-3">
            <input id="customColorInput" type="color" class="w-12 h-8 p-0 border-0 rounded" value="#111118">
            <input id="customColorText" type="text" class="text-sm border rounded px-2 py-1 flex-1" style="background-color: var(--bg-secondary); color: var(--text-primary); border-color: var(--bg-hover);" placeholder="#111118" value="#111118">
          </div>
        </div>

        <div class="mb-6">
            <label class="text-sm mb-2 block" style="color: var(--text-secondary);">User Icon Color</label>
            <div class="flex items-center gap-3">
                <input id="userIconColorInput" type="color" class="w-12 h-8 p-0 border-0 rounded" value="#4b7cff">
                <input id="userIconColorText" type="text" class="text-sm border rounded px-2 py-1 flex-1" style="background-color: var(--bg-secondary); color: var(--text-primary); border-color: var(--bg-hover);" placeholder="#4b7cff" value="#4b7cff">
            </div>
        </div>

        <!-- Account Section -->
        <div class="mb-6">
            <h4 class="text-md mb-3 font-semibold" style="color: var(--text-primary);">Account</h4>
            <div class="space-y-2">
                <button id="changeDisplayNameBtn" class="w-full px-4 py-2 rounded text-sm" style="background-color: var(--bg-secondary); color: var(--text-primary);">Change Display Name</button>
                <div class="flex justify-between">
                <button id="logoutBtn" class="w-[48%] px-4 py-2 rounded transition-colors" style="background-color: #ff6b6b; color: white;">Logout</button>
                <button id="deleteAccountBtn" class="w-[48%] px-4 py-2 rounded text-sm" style="background-color: #ff6b6b; color: white;">Delete Account</button>
                </div>
            </div>
        </div>

        <div class="flex justify-end gap-2">
          <button id="settingsCancel" class="px-4 py-2 rounded transition-colors" style="background-color: var(--bg-secondary); color: var(--text-primary);">Cancel</button>
          <button id="settingsSave" class="px-4 py-2 rounded transition-colors" style="background-color: var(--accent); color: white;">Save</button>
        </div>
      </div>
    </div>
    <footer class="bg-[var(--bg-primary)] text-[var(--text-secondary)] text-center">Dash Faster</footer>
  </body>
</html>
